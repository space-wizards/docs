# Clients, Servers, and Prediction

Let's imagine we want to make a game with a character that can walk around and shoot a gun. At first our game is purely singleplayer, so everything is handled on the player's own computer; it runs the code to keep track of position, health, ammo, etc. and updates it all based on player input.

Eventually, we decide we want to make our game multiplayer. One way to do that is to implement a client/server network. In this network, one system (the server) handles coordinating information between all the other systems that connect to it (the clients). An easy, naive way to make our game multiplayer would be to have all the clients on the server run like before (handling user input, movement, damage, etc) and send any data we want the other players to have to the server. The server would then distribute that information to the other clients, who would use it to display player positions, health bars, and the like.

So, what's the problem? In our current system, we are trusting the clients to keep track of game information. A bad actor could abuse this trust to lie about any of that information if they find a way to mess with how the client sends that code to the server; for example, they could tell the server they are at full health when they've been hit several times, or that they "moved" completely across the map. They can also use information given to them by the server in unintended ways. If the server gives the client the position of every player and trusts it to only show the ones the player can see, the bad actor could get all that information without limit. This means a cheater could become a teleporting immortal with perfect knowledge of everyone on the map!

We can avoid these problems by making the server authoritative; this means that instead of the clients handling player inputs and telling the server the result of it, the clients have to send the server the player's inputs and let it tell them the result. Now the clients can't lie about where they are or how much health they have; if the server runs the inputs and determines that you died, then you're dead. While a client can still lie about the inputs it sends, we've mitigated the damage it can do. This doesn't solve the issue of players abusing information sent by the server, however; the only solution for that is to be careful what you send them and assume the worst.

## Client-Side Prediction

Now the server handles all the important information and clients can't teleport around. Surely we've reached the optimal system, right? Well, we have one final issue that would quickly become apparent if you actually played the game. 

Imagine we want to move forward. We press the 'W' key... and wait. In order to actually move, our client has to send our input to the server. Then, the server has to handle the input along with the inputs of all the other players. Then it has to send back our new position, and finally our client has to update our screen. All of this creates a significant amount of delay, most of which comes from the two times data has to be transferred between the client and the server. But how can we solve that? If we can't trust the client to handle inputs, how can it figure out where the player will go before the server tells it?

Although the server can't trust the client to handle inputs correctly, the client itself can; after all, if it decides to lie, it'll only be lying to itself. This leads to a system called "Client-Side Prediction," or just prediction. Here, the client tries to "predict" what information the server will send back by running the same code the server does. This means that when the player presses the 'W' key, they immediately start to move because the client will run the same movement code the server will. Then, when the server sends back the authoritative information, the client can update the its data with the server's version. Ideally, they will be pretty similar and the player will barely notice anything happened.
